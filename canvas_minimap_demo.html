<!DOCTYPE html>
<html>
<head>
  <style>
    #mainView {
      border: 1px solid black;
      width: 1700px; /* 화면에 표시되는 크기 */
      height: 1700px; /* 화면에 표시되는 크기 */
      overflow: hidden; /* 스크롤 바 제거 */
      cursor: grab; /* 마우스 커서 변경 */
    }
    #mainView:active {
      cursor: grabbing; /* 드래그 중 커서 변경 */
    }
    #miniView {
      border: 1px solid black;
      position: fixed;
      bottom: 10px;
      right: 10px;
    }
  </style>
</head>
<body>
  <canvas id="mainView" width="3000" height="3000"></canvas>
  <canvas id="miniView" width="150" height="150"></canvas>

  <script>
    const mainView = document.getElementById('mainView');
    const mainCtx = mainView.getContext('2d');
    const miniView = document.getElementById('miniView');
    const miniCtx = miniView.getContext('2d');

    const shapes = [
      { x: 100, y: 100, size: 50, color: 'red', isDragging: false },
      { x: 200, y: 200, size: 75, color: 'blue', isDragging: false }
    ];

    const mainViewSize = 3000;
    const monitorSize = 1700;
    const redBoxSize = (monitorSize / mainViewSize) * miniView.width;

    const redBox = { x: 0, y: 0, size: redBoxSize, isDragging: false };

    function drawShapes(ctx, scale = 1) {
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      shapes.forEach(shape => {
        ctx.fillStyle = shape.color;
        ctx.fillRect(shape.x * scale, shape.y * scale, shape.size * scale, shape.size * scale);
      });
    }

    function drawMiniView() {
      miniCtx.clearRect(0, 0, miniView.width, miniView.height);
      drawShapes(miniCtx, miniView.width / mainViewSize);

      miniCtx.strokeStyle = 'red';
      miniCtx.strokeRect(redBox.x, redBox.y, redBox.size, redBox.size);
    }

    function updateRedBoxPositionByMainView(dx, dy) {
      const scale = miniView.width / mainViewSize;
      redBox.x = Math.max(0, Math.min(redBox.x - dx * scale, miniView.width - redBox.size));
      redBox.y = Math.max(0, Math.min(redBox.y - dy * scale, miniView.height - redBox.size));
    }

    function updateRedBoxPosition(x, y) {
      redBox.x = Math.max(0, Math.min(x, miniView.width - redBox.size));
      redBox.y = Math.max(0, Math.min(y, miniView.height - redBox.size));
    }

    function updateMainView() {
      const scale = mainViewSize / miniView.width;
      const viewX = redBox.x * scale;
      const viewY = redBox.y * scale;

      mainCtx.clearRect(0, 0, mainView.width, mainView.height);
      mainCtx.save();
      mainCtx.scale(monitorSize / mainViewSize, monitorSize / mainViewSize);
      mainCtx.translate(-viewX, -viewY);
      drawShapes(mainCtx);
      mainCtx.restore();
    }

    let isDragging = false;
    let startX, startY;

    miniView.addEventListener('mousedown', (event) => {
      const rect = miniView.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      if (x >= redBox.x && x <= redBox.x + redBox.size && y >= redBox.y && y <= redBox.y + redBox.size) {
        redBox.isDragging = true;
      }
    });

    document.addEventListener('mouseup', () => {
      redBox.isDragging = false;
      isDragging = false;
    });

    document.addEventListener('mousemove', (event) => {
      if (redBox.isDragging) {
        const rect = miniView.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        updateRedBoxPosition(x, y);
        drawMiniView();
        updateMainView();
      }

      if (isDragging) {
        const dx = (event.clientX - startX);
        const dy = (event.clientY - startY);

        startX = event.clientX;
        startY = event.clientY;

        updateRedBoxPositionByMainView(dx, dy);
        drawMiniView();
        updateMainView();
      }
    });

    mainView.addEventListener('mousedown', (event) => {
      isDragging = true;
      startX = event.clientX;
      startY = event.clientY;
    });

    mainView.addEventListener('mouseup', () => {
      isDragging = false;
    });

    drawShapes(mainCtx);
    drawMiniView();
  </script>
</body>
</html>
